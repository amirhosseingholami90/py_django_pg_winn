{% extends "itrac/base_itrac.html" %}
{% load humanize %}
{% load widget_tweaks %}

{% block subcontent %}
<div class="row ml-1">  
  <div class="col-md-3" style="border: 2px solid lightgray;">
    <form class="mt-3" method="get">
      {% for field in filter.form %}
        <div class="form-group d-flex">
          <div style="width: 35%;">{{ field.label_tag }}</div>
          {% render_field field class+="form-control" %}
        </div>
      {% endfor %}
      <div class="text-center">
        <button class="btn btn-sm btn-primary mb-3" type="submit">Filter</button>
      </div>
    </form>
  </div>
  <div class="col-md-9" style="height:80vh;">
    <div class="pl-3" style="height:40%; width:100%; overflow:auto;">
      <h3>Found <span class="badge badge-primary badge-pill">{{ filter.qs|length }}</span> issue{{ filter.qs|length|pluralize }}:</h3>
      <ul>
      {% for issue in filter.qs %}
        <li>
          <div class="d-flex">
            <a class="btn btn-sm" role="button" href="#" 
                data-url="{% url 'itrac:issue_detail_partial' issue.id %}">
                <span class="text-muted">{{ issue.coded_id }}:</span> {{ issue.title }}
            </a>
            <a class="btn btn-sm" type="button" data-toggle="collapse" data-target="#issue{{ forloop.counter }}Collapse" aria-expanded="false" aria-controls="collapseExample">
              <span class="small">(...)</span>
            </a>
          </div>
          <div class="collapse" id="issue{{ forloop.counter }}Collapse">
            <div class="pl-3 d-flex" style="border: 2px solid lightgray; width:75%">
              <div style="width:50%">              
                <div class="d-flex"><div title="{{ issue.created_date }}" style="width: 30%;"><b>Created: </b></div>{{ issue.created_date|naturaltime }}</div>
                <div class="d-flex"><div style="width: 30%;"><b>Status: </b></div>{{ issue.get_status_display }}</div>
                <div class="d-flex"><div style="width: 30%;"><b>Type: </b></div>{{ issue.get_issue_type_display }}</div>
              </div>
              <div style="width:50%">
                <div class="d-flex"><div style="width: 30%;"><b>Reporter: </b></div>{{ issue.author }}</div>
                <div class="d-flex"><div style="width: 30%;"><b>Assignee: </b></div>{{ issue.assignee }}</div>
                <div class="d-flex">
                  <div style="width: 30%;"><b>Tags: </b></div>
                  <div>
                  {% for tag in issue.tags.all %}
                    <a class="mr-1" href="{% url 'itrac:issues_with_tag' %}?tag={{ tag }}">{{ tag.title }}</a>
                  {% endfor %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </li>
      {% endfor %}
      </ul>
    </div>
    <div class="mt-3 pl-3" id="filter-issue-details" style="overflow:auto; border-top:2px solid lightgray;">
      Click an issue to view details
    </div>
  </div>
</div>
{% endblock %}
